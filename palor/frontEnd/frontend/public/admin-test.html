<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        button { margin: 5px; padding: 10px 15px; background: #e91e63; color: white; border: none; border-radius: 5px; cursor: pointer; }
        .success { color: green; }
        .error { color: red; }
        .appointment { margin: 10px 0; padding: 10px; background: #f5f5f5; border-radius: 5px; }
    </style>
</head>
<body>
    <h1>üîß Admin Portal Test</h1>
    
    <div class="section">
        <h2>Step 1: Admin Login</h2>
        <button onclick="adminLogin()">Login as Admin</button>
        <div id="loginStatus"></div>
    </div>

    <div class="section">
        <h2>Step 2: Fetch All Appointments</h2>
        <button onclick="fetchAllAppointments()">Fetch Appointments</button>
        <div id="appointmentsStatus"></div>
        <div id="appointmentsList"></div>
    </div>

    <div class="section">
        <h2>Step 3: Test Direct Admin Page</h2>
        <button onclick="openAdminPage()">Open Admin Dashboard</button>
        <button onclick="openAppointmentsPage()">Open Appointments Page</button>
    </div>

    <script>
        async function adminLogin() {
            try {
                document.getElementById('loginStatus').innerHTML = 'Logging in as admin...';
                
                const response = await fetch('http://localhost:8000/api/v1/users/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        email: 'anitadahal54@yahoo.com',
                        password: 'Banepa@01'
                    })
                });
                
                const data = await response.json();
                console.log('Admin login response:', data);
                
                if (data.success && data.message.user.role === 'admin') {
                    const { user, accessToken, refreshToken } = data.message;
                    
                    // Store both regular and admin tokens for testing
                    localStorage.setItem('token', accessToken);
                    localStorage.setItem('user', JSON.stringify(user));
                    localStorage.setItem('adminToken', accessToken);
                    localStorage.setItem('adminUser', JSON.stringify(user));
                    
                    document.getElementById('loginStatus').innerHTML = 
                        `<span class="success">‚úÖ Admin logged in: ${user.firstname} ${user.lastname} (${user.role})</span>`;
                } else {
                    document.getElementById('loginStatus').innerHTML = 
                        `<span class="error">‚ùå Login failed or not admin: ${data.message}</span>`;
                }
            } catch (error) {
                document.getElementById('loginStatus').innerHTML = 
                    `<span class="error">‚ùå Error: ${error.message}</span>`;
                console.error('Admin login error:', error);
            }
        }

        async function fetchAllAppointments() {
            try {
                const token = localStorage.getItem('adminToken') || localStorage.getItem('token');
                if (!token) {
                    document.getElementById('appointmentsStatus').innerHTML = 
                        '<span class="error">‚ùå Please login first</span>';
                    return;
                }

                document.getElementById('appointmentsStatus').innerHTML = 'Fetching appointments...';

                const response = await fetch('http://localhost:8000/api/v1/appointments/getAllAppointments', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                const data = await response.json();
                console.log('Appointments response:', data);

                if (data.success) {
                    const appointments = data.message.appointments;
                    document.getElementById('appointmentsStatus').innerHTML = 
                        `<span class="success">‚úÖ Found ${appointments.length} appointments</span>`;
                    
                    let appointmentsList = '';
                    appointments.forEach(apt => {
                        appointmentsList += `
                            <div class="appointment">
                                <strong>Customer:</strong> ${apt.userId?.firstname} ${apt.userId?.lastname}<br>
                                <strong>Service:</strong> ${apt.serviceId?.name || 'Service Deleted'}<br>
                                <strong>Date:</strong> ${new Date(apt.appointmentDate).toLocaleDateString()}<br>
                                <strong>Time:</strong> ${apt.appointmentTime}<br>
                                <strong>Status:</strong> <span style="color: ${apt.status === 'pending' ? 'orange' : apt.status === 'cancelled' ? 'red' : 'green'}">${apt.status}</span><br>
                                <strong>Price:</strong> $${apt.price || apt.serviceId?.price || 0}<br>
                                ${apt.notes ? `<strong>Notes:</strong> ${apt.notes}<br>` : ''}
                                <small>ID: ${apt._id}</small>
                            </div>
                        `;
                    });
                    
                    document.getElementById('appointmentsList').innerHTML = appointmentsList;
                } else {
                    document.getElementById('appointmentsStatus').innerHTML = 
                        `<span class="error">‚ùå Failed to fetch appointments: ${data.message}</span>`;
                }
            } catch (error) {
                document.getElementById('appointmentsStatus').innerHTML = 
                    `<span class="error">‚ùå Error: ${error.message}</span>`;
                console.error('Fetch appointments error:', error);
            }
        }

        function openAdminPage() {
            window.open('http://localhost:5174/admin/dashboard', '_blank');
        }

        function openAppointmentsPage() {
            window.open('http://localhost:5174/admin/appointments', '_blank');
        }
    </script>
</body>
</html>